/*!
* sycamore.js 0.2.0 - A decision tree based chat library.
*
* @author       Todd Armstrong <todd@toddarmstrong.com.au>
* @homepage     https://github.com/toddarmstrong/sycamore.js#readme
* @copyright    Copyright (c) 2018 Todd Armstrong <todd@toddarmstrong.com.au>
* @license      MIT
* @version      0.2.0
*/
var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},knot=function(){function e(e,t){return s[e]=s[e]||[],s[e].push(t),this}function t(t,n){return n._once=!0,e(t,n),this}function n(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?s[e].splice(s[e].indexOf(t),1):delete s[e],this}function a(e){for(var t=this,a=arguments.length,i=Array(a>1?a-1:0),r=1;r<a;r++)i[r-1]=arguments[r];var o=s[e]&&s[e].slice();return o&&o.forEach(function(a){a._once&&n(e,a),a.apply(t,i)}),this}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=Object.create(null);return _extends({},i,{on:e,once:t,off:n,emit:a})},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Sycamore=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),this.emitter=knot();var a=void 0;a=n.speed&&"number"==typeof n.speed&&n.speed>=1&&n.speed<=10?n.speed:5;var i=void 0;i=n.delay&&"number"==typeof n.delay&&n.delay>=0?n.delay:0;var s=void 0;s=!!(n.delayMinMax&&Array.isArray(n.delayMinMax)&&2===n.delayMinMax.length&&n.delayMinMax[0]>0&&n.delayMinMax[1]>0&&n.delayMinMax[0]<n.delayMinMax[1])&&n.delayMinMax,this.options={speed:a,delay:i,delayMinMax:s,firstQuestion:n.firstQuestion||!1};var r=6;if(this.charactersPerSecond=2*r*(this.options.speed/10),this.currentQuestion=!1,this.answeredData=[],t instanceof Array)this.data=t;else if(t)throw new Error("Data is not an array.");return this}return createClass(e,[{key:"init",value:function(e){e?this._findAndProcessDataObj(e):this.options.firstQuestion?this._findAndProcessDataObj(this.options.firstQuestion):this._processDataObj(this.data[0])}},{key:"answer",value:function(e){this._answerQuestion(e)}},{key:"on",value:function(){var e;return(e=this.emitter).on.apply(e,arguments)}},{key:"off",value:function(){var e;return(e=this.emitter).off.apply(e,arguments)}},{key:"_calculateWait",value:function(e){var t=e.length,n=t/this.charactersPerSecond;return n*=1e3,n=Math.round(n)}},{key:"_calculateDelay",value:function(){return this.options.delayMinMax?Math.floor(Math.random()*(this.options.delayMinMax[1]-this.options.delayMinMax[0]+1)+this.options.delayMinMax[0]):this.options.delay}},{key:"_findDataObjByID",value:function(e){var t=this;return new Promise(function(n,a){t.data.forEach(function(t){t.id===e&&n(t)}),a("No message object found")})}},{key:"_processDataObj",value:function(e){if("message"===e.type)this._sendMessage(e);else{if("question"!==e.type)throw new Error("Data object doesn't have a valid type.");this._askQuestion(e)}}},{key:"_findAndProcessDataObj",value:function(e){var t=this;this._findDataObjByID(e).then(function(e){t._processDataObj(e)}).catch(function(e){throw new Error(e)})}},{key:"_sendMessage",value:function(e){var t=this,n=this._calculateWait(e.text);this.emitter.emit("typing",n),setTimeout(function(){t.emitter.emit("message",e);var n=t._calculateDelay();t.emitter.emit("delay",n),setTimeout(function(){t._findAndProcessDataObj(e.next)},n)},n)}},{key:"_askQuestion",value:function(e){var t=this;this.currentQuestion=e;var n=this._calculateWait(e.question);this.emitter.emit("typing",n),setTimeout(function(){t.emitter.emit("question",e)},n)}},{key:"_answerQuestion",value:function(e){var t=this,n={question:this.currentQuestion.question,answer:e.text};if(this.emitter.emit("answered",n),this.answeredData.push(n),this.emitter.emit("update",this.answeredData),e.callback){if("function"!=typeof e.callback)throw new Error("The callback for '"+e.text+"' is not a function");e.callback()}if(e.next){var a=this._calculateDelay();this.emitter.emit("delay",a),setTimeout(function(){t._findAndProcessDataObj(e.next)},a)}else this.emitter.emit("finished",this.answeredData)}}]),e}();export default Sycamore;
//# sourceMappingURL=sycamore.mjs.map
